# 网易云音乐功能使用说明

## 概述

APlayer Gutenberg 区块现在支持网易云音乐播放功能！您可以直接通过网易云音乐的歌曲ID或歌单ID来播放音乐，无需下载音频文件。

## 功能特点

- ✅ 支持网易云音乐单曲播放
- ✅ 支持网易云音乐歌单播放
- ✅ 支持网易云音乐链接自动解析
- ✅ 完整的播放器控制功能
- ✅ 自动获取歌曲信息和封面
- ✅ 支持歌词显示（如果可用）
- ✅ 与本地文件播放器相同的主题和设置选项

## 使用方法

### 在 WordPress 编辑器中使用

1. **添加 APlayer 区块**
   - 在 Gutenberg 编辑器中搜索"APlayer"
   - 插入"APlayer 音乐播放器"区块

2. **选择音乐来源**
   - 在右侧设置面板中，选择"音乐来源"
   - 从下拉菜单中选择"网易云音乐"

3. **配置网易云音乐**
   
   **方法一：粘贴链接（推荐）**
   - 从网易云音乐复制歌曲或歌单的分享链接
   - 粘贴到"网易云音乐链接"输入框
   - 系统会自动解析链接并提取ID
   
   **方法二：手动输入ID**
   - 选择类型（单曲/歌单）
   - 在"ID"字段中输入对应的数字ID

4. **调整播放器设置**
   - 主题颜色、循环模式、播放顺序等
   - 所有设置与本地文件模式相同

### 获取网易云音乐ID的方法

#### 歌曲ID
1. 打开网易云音乐网页版或APP
2. 找到要播放的歌曲
3. 复制分享链接，格式类似：`https://music.163.com/song?id=123456`
4. 数字部分（123456）就是歌曲ID

#### 歌单ID
1. 打开要分享的歌单
2. 复制分享链接，格式类似：`https://music.163.com/playlist?id=123456`
3. 数字部分（123456）就是歌单ID

### 支持的链接格式

- 歌曲链接：`https://music.163.com/song?id=123456`
- 歌单链接：`https://music.163.com/playlist?id=123456`
- 移动端链接：`https://y.music.163.com/m/song?id=123456`

## 播放器设置说明

| 设置项 | 说明 | 默认值 |
|--------|------|--------|
| 主题颜色 | 播放器的主色调 | #b7daff |
| 循环模式 | 全部循环/单曲循环/不循环 | 全部循环 |
| 播放顺序 | 列表顺序/随机播放 | 列表顺序 |
| 默认音量 | 初始音量大小 | 0.7 |
| 自动播放 | 页面加载时自动播放 | 关闭 |
| 折叠播放列表 | 默认折叠歌曲列表 | 关闭 |
| 显示歌词 | 显示歌词（如果可用） | 关闭 |

## 常见问题

### Q: 为什么有些歌曲无法播放？
A: 网易云音乐的版权限制可能导致某些歌曲在某些地区无法播放。建议选择无版权限制的歌曲。

### Q: 歌单太长，加载很慢怎么办？
A: 大型歌单可能需要较长时间加载。建议使用较小的歌单（少于50首歌）以获得更好的体验。

### Q: 如何在同一页面使用多个播放器？
A: 可以添加多个 APlayer 区块，每个区块可以配置不同的音乐来源和设置。

### Q: 网易云音乐功能需要网络连接吗？
A: 是的，网易云音乐功能需要网络连接来获取音乐数据和播放音频。

## 技术细节

本功能基于以下技术实现：
- **APlayer**: HTML5 音频播放器
- **Meting.js**: 音乐平台API聚合工具
- **网易云音乐API**: 通过Meting.js调用

## API配置

### 内置API
插件已内置一个完整的Meting API服务，无需额外配置即可使用。内置API具有以下特点：
- 基于[meting-api](https://github.com/injahow/meting-api)项目
- 自动缓存播放列表，提高加载速度
- 支持中文歌词显示
- 完全本地化，无需依赖外部服务

### 自定义API
如果您有自己的Meting API服务器，可以通过以下方式配置：

1. **在WordPress后台配置**
   - 进入"设置" → "APlayer设置"
   - 输入您的API地址
   - 格式：`https://your-domain.com/meting/?server=:server&type=:type&id=:id&r=:r`

2. **通过代码配置**
   ```javascript
   // 在页面头部添加
   window.meting_api = 'https://your-api-domain.com/meting/?server=:server&type=:type&id=:id&r=:r';
   ```

### API格式要求
自定义API必须包含以下占位符：
- `:server` - 音乐平台（netease、tencent等）
- `:type` - 请求类型（song、playlist等）
- `:id` - 资源ID
- `:r` - 随机数（用于缓存控制）

## 故障排除

### API相关问题

#### 网易云音乐无法播放
1. 检查网络连接
2. 确认API服务是否正常
3. 尝试更换其他歌曲或歌单

#### API请求失败
1. 检查API地址是否正确
2. 确认服务器支持跨域请求
3. 查看浏览器控制台的错误信息

#### 歌曲加载缓慢
1. 检查API服务器的响应速度
2. 考虑启用缓存功能
3. 选择较小的歌单

## 更新日志

### v1.1.0
- 新增网易云音乐支持
- 支持歌曲和歌单播放
- 支持链接自动解析
- 内置完整的Meting API服务
- 添加自定义API配置功能
- 保持与本地文件模式的完整兼容性

## 示例

### 播放网易云热门歌单
```
音乐来源: 网易云音乐
类型: 歌单
ID: 3778678
```

### 播放特定歌曲
```
音乐来源: 网易云音乐
类型: 单曲
ID: 123456
```

### 使用链接自动解析
```
网易云音乐链接: https://music.163.com/playlist?id=3778678
```

## 支持

如果您在使用过程中遇到问题，请检查：
1. 网络连接是否正常
2. 音乐ID是否正确
3. 浏览器控制台是否有错误信息

有关更多技术支持，请参考项目的 GitHub 仓库。 